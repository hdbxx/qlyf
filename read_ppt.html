<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PPT文本提取工具</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        .slide-item {
            transition: all 0.2s ease;
        }
        .slide-item:hover {
            background-color: #f8fafc;
        }
        .progress-bar {
            transition: width 0.3s ease;
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <div class="container mx-auto px-4 py-8 max-w-5xl">
        <!-- 标题区域 -->
        <header class="text-center mb-10">
            <h1 class="text-[clamp(1.8rem,4vw,2.5rem)] font-bold text-gray-800 mb-3">
                <i class="fa fa-file-powerpoint-o text-blue-600 mr-2"></i>PPT文本提取工具
            </h1>
            <p class="text-gray-600 max-w-2xl mx-auto">
                上传PPT文件(.pptx)，提取其中所有文本内容。所有处理均在本地完成，保护您的隐私。
            </p>
        </header>

        <!-- 主要内容区 -->
        <main>
            <!-- 上传区域 -->
            <div id="upload-container" class="bg-white rounded-xl shadow-md p-8 mb-8 text-center">
                <div id="drop-area" class="border-2 border-dashed border-gray-300 rounded-lg p-10 cursor-pointer hover:border-blue-500 transition-colors">
                    <i class="fa fa-cloud-upload text-5xl text-blue-500 mb-4"></i>
                    <h3 class="text-xl font-semibold text-gray-700 mb-2">拖放PPT文件到此处</h3>
                    <p class="text-gray-500 mb-6">或点击下方按钮选择文件</p>
                    <label for="file-input" class="bg-blue-500 hover:bg-blue-600 text-white font-medium py-3 px-6 rounded-lg cursor-pointer transition-colors inline-flex items-center">
                        <i class="fa fa-folder-open mr-2"></i>选择PPT文件
                    </label>
                    <input type="file" id="file-input" accept=".pptx" class="hidden">
                    <p class="text-gray-400 text-sm mt-4">支持 .pptx 格式文件</p>
                </div>
            </div>

            <!-- 进度区域 -->
            <div id="progress-container" class="bg-white rounded-xl shadow-md p-6 mb-8 hidden fade-in">
                <div class="flex items-center mb-4">
                    <i class="fa fa-spinner fa-spin text-blue-500 mr-3"></i>
                    <h3 class="text-lg font-medium text-gray-800">正在处理文件...</h3>
                </div>
                <div class="w-full bg-gray-200 rounded-full h-2.5 mb-2">
                    <div id="progress-bar" class="progress-bar bg-blue-500 h-2.5 rounded-full" style="width: 0%"></div>
                </div>
                <p id="progress-text" class="text-gray-600 text-sm">准备中...</p>
            </div>

            <!-- 结果区域 -->
            <div id="results-container" class="bg-white rounded-xl shadow-md overflow-hidden hidden fade-in">
                <div class="bg-gray-50 border-b border-gray-200 p-6 flex flex-wrap justify-between items-center gap-4">
                    <div>
                        <h3 class="text-xl font-semibold text-gray-800 flex items-center">
                            <i class="fa fa-file-text-o text-blue-500 mr-2"></i>
                            <span id="result-filename">提取结果</span>
                        </h3>
                        <div class="flex items-center mt-2 text-sm text-gray-500 space-x-4">
                            <span><i class="fa fa-file-o mr-1"></i> 幻灯片: <span id="slide-count">0</span></span>
                            <span><i class="fa fa-font mr-1"></i> 总字数: <span id="word-count">0</span></span>
                        </div>
                    </div>
                    <div class="flex space-x-3">
                        <button id="copy-all" class="bg-gray-100 hover:bg-gray-200 text-gray-700 font-medium py-2 px-4 rounded-lg transition-colors flex items-center">
                            <i class="fa fa-copy mr-2"></i>复制全部
                        </button>
                        <button id="download-text" class="bg-green-500 hover:bg-green-600 text-white font-medium py-2 px-4 rounded-lg transition-colors flex items-center">
                            <i class="fa fa-download mr-2"></i>下载文本
                        </button>
                    </div>
                </div>
                
                <div class="p-6">
                    <div id="extracted-text" class="space-y-6">
                        <!-- 提取的文本将在这里显示 -->
                    </div>
                    
                    <div id="no-text-message" class="text-center py-10 hidden">
                        <i class="fa fa-info-circle text-gray-400 text-3xl mb-3"></i>
                        <p class="text-gray-500">未从PPT中提取到任何文本内容</p>
                    </div>
                </div>
            </div>
        </main>

        <!-- 通知提示 -->
        <div id="notification" class="fixed bottom-5 right-5 px-6 py-3 rounded-lg shadow-lg transform translate-y-20 opacity-0 transition-all duration-300 flex items-center z-50">
            <i id="notification-icon" class="fa fa-check-circle mr-2"></i>
            <span id="notification-text">操作成功</span>
        </div>
    </div>

    <footer class="bg-white border-t border-gray-200 py-6 mt-12">
        <div class="container mx-auto px-4 text-center text-gray-500 text-sm">
            <p>PPT文本提取工具 &copy; 2023 | 所有处理均在本地完成，不会上传您的文件</p>
        </div>
    </footer>

    <script>
        // DOM元素引用
        const fileInput = document.getElementById('file-input');
        const dropArea = document.getElementById('drop-area');
        const uploadContainer = document.getElementById('upload-container');
        const progressContainer = document.getElementById('progress-container');
        const progressBar = document.getElementById('progress-bar');
        const progressText = document.getElementById('progress-text');
        const resultsContainer = document.getElementById('results-container');
        const extractedText = document.getElementById('extracted-text');
        const noTextMessage = document.getElementById('no-text-message');
        const resultFilename = document.getElementById('result-filename');
        const slideCount = document.getElementById('slide-count');
        const wordCount = document.getElementById('word-count');
        const copyAllBtn = document.getElementById('copy-all');
        const downloadTextBtn = document.getElementById('download-text');
        const notification = document.getElementById('notification');
        const notificationIcon = document.getElementById('notification-icon');
        const notificationText = document.getElementById('notification-text');

        // 存储提取的文本数据
        let allText = '';
        let currentFileName = '';

        // 初始化事件监听
        function initEventListeners() {
            // 文件选择
            fileInput.addEventListener('change', handleFileSelection);
            
            // 拖放功能
            dropArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                dropArea.classList.add('bg-blue-50', 'border-blue-500');
            });
            
            dropArea.addEventListener('dragleave', () => {
                dropArea.classList.remove('bg-blue-50', 'border-blue-500');
            });
            
            dropArea.addEventListener('drop', (e) => {
                e.preventDefault();
                dropArea.classList.remove('bg-blue-50', 'border-blue-500');
                
                if (e.dataTransfer.files.length) {
                    fileInput.files = e.dataTransfer.files;
                    handleFileSelection(e);
                }
            });
            
            // 复制全部文本
            copyAllBtn.addEventListener('click', copyAllText);
            
            // 下载文本
            downloadTextBtn.addEventListener('click', downloadTextFile);
        }

        // 处理文件选择
        function handleFileSelection(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            // 验证文件类型
            if (!file.name.toLowerCase().endsWith('.pptx')) {
                showNotification('请选择.pptx格式的文件', 'exclamation-circle', 'text-red-500', 'bg-red-50');
                return;
            }
            
            currentFileName = file.name;
            resultFilename.textContent = `提取结果: ${currentFileName}`;
            
            // 显示进度区域，隐藏上传区域
            uploadContainer.classList.add('hidden');
            progressContainer.classList.remove('hidden');
            progressBar.style.width = '0%';
            progressText.textContent = '正在解析文件...';
            
            // 处理PPT文件
            processPPTFile(file);
        }

        // 处理PPT文件
        function processPPTFile(file) {
            const reader = new FileReader();
            
            reader.onload = function(e) {
                const content = e.target.result;
                
                // 使用JSZip解析PPTX文件
                JSZip.loadAsync(content).then(function(zip) {
                    // 提取所有幻灯片文本
                    extractTextFromPPT(zip).then(function({text, slides}) {
                        allText = text;
                        
                        // 更新进度
                        progressBar.style.width = '100%';
                        progressText.textContent = '处理完成';
                        
                        // 显示结果
                        setTimeout(() => {
                            progressContainer.classList.add('hidden');
                            resultsContainer.classList.remove('hidden');
                            
                            // 显示提取的文本
                            displayExtractedText(slides);
                            
                            // 更新统计信息
                            slideCount.textContent = slides.length;
                            wordCount.textContent = allText.length;
                            
                            // 平滑滚动到结果区域
                            resultsContainer.scrollIntoView({ behavior: 'smooth' });
                            
                            showNotification('文本提取成功', 'check-circle', 'text-green-500', 'bg-green-50');
                        }, 600);
                    }).catch(function(error) {
                        console.error('提取文本失败:', error);
                        progressText.textContent = '处理失败，请重试';
                        showNotification('提取文本失败', 'exclamation-circle', 'text-red-500', 'bg-red-50');
                    });
                }).catch(function(error) {
                    console.error('解析PPT文件失败:', error);
                    progressText.textContent = '解析文件失败，请重试';
                    showNotification('解析文件失败', 'exclamation-circle', 'text-red-500', 'bg-red-50');
                });
            };
            
            reader.onerror = function() {
                console.error('文件读取错误');
                progressText.textContent = '读取文件失败';
                showNotification('读取文件失败', 'exclamation-circle', 'text-red-500', 'bg-red-50');
            };
            
            // 读取文件内容
            reader.readAsArrayBuffer(file);
        }

        // 从PPT中提取文本
        function extractTextFromPPT(zip) {
            return new Promise((resolve, reject) => {
                // 先读取幻灯片数量
                zip.file('ppt/presentation.xml').async('string').then(presentationContent => {
                    const parser = new DOMParser();
                    const doc = parser.parseFromString(presentationContent, 'application/xml');
                    const slideElements = doc.querySelectorAll('p\\:sldId, sldId'); // 兼容不同命名空间
                    const totalSlides = slideElements.length;
                    
                    if (totalSlides === 0) {
                        resolve({ text: '', slides: [] });
                        return;
                    }
                    
                    let processedSlides = 0;
                    const slidesText = [];
                    let fullText = '';
                    
                    // 处理每张幻灯片
                    for (let i = 1; i <= totalSlides; i++) {
                        const slidePath = `ppt/slides/slide${i}.xml`;
                        const slideFile = zip.file(slidePath);
                        
                        if (!slideFile) {
                            processedSlides++;
                            updateProgress(processedSlides, totalSlides);
                            continue;
                        }
                        
                        slideFile.async('string').then(slideContent => {
                            const slideDoc = parser.parseFromString(slideContent, 'application/xml');
                            // 查找所有文本元素（处理不同命名空间）
                            const textElements = slideDoc.querySelectorAll('a\\:t, t');
                            
                            let slideText = '';
                            textElements.forEach(el => {
                                if (el.textContent && el.textContent.trim()) {
                                    slideText += el.textContent + ' ';
                                }
                            });
                            
                            // 清理文本
                            slideText = slideText.trim().replace(/\s+/g, ' ');
                            
                            if (slideText) {
                                slidesText.push({
                                    slideNumber: i,
                                    text: slideText
                                });
                                fullText += slideText + '\n\n';
                            }
                            
                            processedSlides++;
                            updateProgress(processedSlides, totalSlides);
                            
                            // 所有幻灯片处理完成
                            if (processedSlides === totalSlides) {
                                resolve({
                                    text: fullText.trim(),
                                    slides: slidesText
                                });
                            }
                        }).catch(error => {
                            console.error(`处理幻灯片 ${i} 时出错:`, error);
                            processedSlides++;
                            updateProgress(processedSlides, totalSlides);
                            
                            if (processedSlides === totalSlides) {
                                resolve({
                                    text: fullText.trim(),
                                    slides: slidesText
                                });
                            }
                        });
                    }
                }).catch(reject);
            });
        }

        // 更新进度条
        function updateProgress(processed, total) {
            const percentage = Math.round((processed / total) * 100);
            progressBar.style.width = `${percentage}%`;
            progressText.textContent = `正在提取文本: ${processed}/${total} 幻灯片`;
        }

        // 显示提取的文本
        function displayExtractedText(slides) {
            extractedText.innerHTML = '';
            
            if (slides.length === 0) {
                noTextMessage.classList.remove('hidden');
                return;
            }
            
            noTextMessage.classList.add('hidden');
            
            slides.forEach(slide => {
                const slideElement = document.createElement('div');
                slideElement.className = 'slide-item p-4 rounded-lg border border-gray-100';
                
                const slideHeader = document.createElement('h4');
                slideHeader.className = 'font-semibold text-blue-600 mb-2 flex items-center';
                slideHeader.innerHTML = `<i class="fa fa-file-powerpoint-o mr-2"></i> 幻灯片 ${slide.slideNumber}`;
                
                const slideContent = document.createElement('p');
                slideContent.className = 'text-gray-700 leading-relaxed';
                slideContent.textContent = slide.text;
                
                slideElement.appendChild(slideHeader);
                slideElement.appendChild(slideContent);
                extractedText.appendChild(slideElement);
            });
        }

        // 复制所有文本
        function copyAllText() {
            if (!allText) {
                showNotification('没有可复制的文本', 'info-circle', 'text-blue-500', 'bg-blue-50');
                return;
            }
            
            navigator.clipboard.writeText(allText).then(() => {
                showNotification('所有文本已复制到剪贴板', 'check-circle', 'text-green-500', 'bg-green-50');
            }).catch(err => {
                console.error('复制失败:', err);
                // 降级方案：创建文本区域并复制
                const textarea = document.createElement('textarea');
                textarea.value = allText;
                document.body.appendChild(textarea);
                textarea.select();
                document.execCommand('copy');
                document.body.removeChild(textarea);
                showNotification('文本已复制到剪贴板', 'check-circle', 'text-green-500', 'bg-green-50');
            });
        }

        // 下载文本文件
        function downloadTextFile() {
            if (!allText) {
                showNotification('没有可下载的文本', 'info-circle', 'text-blue-500', 'bg-blue-50');
                return;
            }
            
            const filename = currentFileName.replace('.pptx', '') + '_提取文本.txt';
            const blob = new Blob([allText], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showNotification('文本文件已下载', 'download', 'text-green-500', 'bg-green-50');
        }

        // 显示通知
        function showNotification(message, icon, textColor, bgColor) {
            notificationText.textContent = message;
            notificationIcon.className = `fa fa-${icon} mr-2 ${textColor}`;
            notification.className = `fixed bottom-5 right-5 px-6 py-3 rounded-lg shadow-lg transform translate-y-0 opacity-100 transition-all duration-300 flex items-center z-50 ${bgColor}`;
            
            // 3秒后隐藏
            setTimeout(() => {
                notification.classList.add('translate-y-20', 'opacity-0');
            }, 3000);
        }

        // 初始化应用
        document.addEventListener('DOMContentLoaded', initEventListeners);
    </script>
</body>
</html>
    